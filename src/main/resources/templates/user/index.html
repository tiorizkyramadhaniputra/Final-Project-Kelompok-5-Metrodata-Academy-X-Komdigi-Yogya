<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>Perpus Online</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    #customSearch {
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h2 class="text-center mb-4">Perpustakaan Online</h2>

    <!-- Search bar seperti versi lama -->
    <div class="row mb-3 align-items-center">
      <div class="col-md-8">
        <input type="text" id="customSearch" class="form-control" placeholder="Cari buku...">
      </div>
      <div class="col-md-2">
        <button id="searchBtn" class="btn btn-primary w-100">Cari</button>
      </div>
      <div class="col-md-2 text-end">
        <a href="/login" class="btn btn-outline-primary w-100">Login Admin</a>
      </div>
    </div>

    <table id="userTable" class="display table table-striped table-bordered" style="width:100%">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Judul</th>
          <th>Penulis</th>
          <th>Penerbit</th>
          <th>Tahun</th>
          <th>Kategori</th>
          <th>Stok</th>
          <th>Gambar</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script>
  $(document).ready(function(){
    const tbl = $('#userTable').DataTable({
      ajax: {
        url: '/api/buku',
        dataSrc: ''
      },
      columnDefs: [
        { className: "text-center", targets: "_all" }
      ],
      columns: [
          { data: 'id' },
          { data: 'judul' },
          { data: 'penulis' },
          { data: 'penerbit' },
          { data: 'tahun' },
          { data: 'kategori' },
          { data: 'stok' },
          { 
            data: 'gambar',
            render: function(data){
              return data ? `<img src="/uploads/${data}" width="60" height="80" style="object-fit:cover;border-radius:6px;"/>` : '-';
            }
          },
          { 
            data: 'id',
            render: function(id){
              return `<a href="/user/detail?id=${id}" class="btn btn-sm btn-info text-white">Detail</a>`;
            }
          }
      ]
    });

    // Hilangkan search bawaan DataTables
    $('#userTable_filter').hide();

    // Event untuk tombol Cari
    $('#searchBtn').on('click', function() {
      const query = $('#customSearch').val();
      tbl.search(query).draw();
    });

    // Event untuk mengetik otomatis search (tanpa klik)
    $('#customSearch').on('keyup', function() {
      const query = $(this).val();
      tbl.search(query).draw();
    });
  });
  </script>
</body>
</html>
