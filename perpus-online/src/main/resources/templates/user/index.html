<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>Perpustakaan Online</title>

  <!-- Bootstrap & DataTables -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f8fb, #ffffff);
      color: #25314a;
    }

    h2 {
      font-weight: 700;
      color: #2a3b63;
    }

    .card-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 30px;
    }

    .form-control, .btn {
      border-radius: 8px !important;
    }

    .input-group-text {
      background-color: #6f86d6;
      border: none;
      color: white;
      border-radius: 8px 0 0 8px;
    }

    #customSearch {
      border: 1.5px solid #6f86d6;
      transition: 0.3s;
    }

    #customSearch:focus {
      box-shadow: 0 0 8px rgba(111,134,214,0.4);
      border-color: #5c73c4;
    }

    .btn-outline-primary {
      border-color: #6f86d6;
      color: #6f86d6;
    }

    .btn-outline-primary:hover {
      background-color: #6f86d6;
      color: white;
      box-shadow: 0 3px 10px rgba(111,134,214,0.3);
    }

    table.dataTable thead th {
      background-color: #6f86d6 !important;
      color: white;
      text-align: center;
      font-weight: 600;
    }

    table.dataTable tbody td {
      vertical-align: middle;
      text-align: center;
    }

    .btn-info {
      background-color: #5c73c4;
      border: none;
    }

    .btn-info:hover {
      background-color: #4a63b1;
    }

    /* Responsive tweak */
    @media (max-width: 768px) {
      .card-container {
        padding: 20px;
      }
      .btn {
        margin-top: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="card-container">
      <h2 class="text-center mb-4">ðŸ“š Perpustakaan Online</h2>

      <!-- Search bar dan login -->
      <div class="row mb-4 align-items-center justify-content-center">
        <div class="col-md-9 mb-3 mb-md-0">
          <div class="input-group shadow-sm">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" id="customSearch" class="form-control" placeholder="Cari judul, penulis, atau kategori...">
          </div>
        </div>
        <div class="col-md-3 text-md-end">
          <a href="/login" class="btn btn-outline-primary w-100">Login Admin</a>
        </div>
      </div>

      <!-- Tabel Buku -->
      <div class="table-responsive">
        <table id="userTable" class="display table table-striped table-bordered" style="width:100%">
          <thead>
            <tr>
              <th>ID</th>
              <th>Judul</th>
              <th>Penulis</th>
              <th>Penerbit</th>
              <th>Tahun</th>
              <th>Kategori</th>
              <th>Stok</th>
              <th>Gambar</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.js"></script>
  <script>
  $(document).ready(function(){
    const tbl = $('#userTable').DataTable({
      ajax: {
        url: '/api/buku',
        dataSrc: ''
      },
      columnDefs: [
        { className: "text-center", targets: "_all" }
      ],
      columns: [
          { data: 'id' },
          { data: 'judul' },
          { data: 'penulis' },
          { data: 'penerbit' },
          { data: 'tahun' },
          { data: 'kategori' },
          { 
            data: 'stok',
            render: function(stok){
              return stok > 0 
                ? `<span class="badge bg-success px-3 py-2">${stok}</span>` 
                : `<span class="badge bg-danger px-3 py-2">Habis</span>`;
            }
          },
          { 
            data: 'gambar',
            render: function(data){
              return data 
                ? `<img src="/uploads/${data}" width="60" height="80" style="object-fit:cover;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.1);"/>` 
                : '<div class="text-muted">-</div>';
            }
          },
          { 
            data: 'id',
            render: function(id){
              return `<a href="/user/detail?id=${id}" class="btn btn-sm btn-info text-white">Detail</a>`;
            }
          }
      ]
    });

    // Hilangkan search bawaan DataTables
    $('#userTable_filter').hide();

    // Live search (langsung filter saat user mengetik)
    $('#customSearch').on('keyup input', function() {
      tbl.search($(this).val()).draw();
    });
  });
  </script>
</body>
</html>
